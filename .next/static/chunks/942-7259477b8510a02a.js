"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{5942:function(e,n,t){t.d(n,{V:function(){return x}});var s=t(7437),r=t(2265),a=t(2693),l=t(2666),i=t(8045);function o(){let{sendName:e,thisUser:n}=(0,a.U)(),[t,l]=(0,r.useState)("");return(0,s.jsxs)("div",{className:"form flex flex-row",children:[(0,s.jsx)("input",{value:t,onChange:e=>l(e.target.value),type:"text",placeholder:"User Name",className:"input input-bordered w-full max-w-xs rounded-2xl mr-2 text-sm input-primary"}),(0,s.jsx)("button",{className:"btn btn-primary rounded-2xl",disabled:!n||""===t,onClick:()=>{l(""),e(t)},children:"Change Name"})]})}let u=()=>{let{sendIsTyping:e,sendMessage:n,usersWhoAreTyping:t}=(0,l.U)(),{thisUser:u}=(0,a.U)(),[d,c]=(0,r.useState)(null),f=(0,i.Nr)(d,3e3);(0,r.useEffect)(()=>{u&&(c(null),e(u,!1))},[e,u,f]);let[x,m]=(0,r.useState)("");return(0,s.jsxs)("div",{className:"chat-form",children:[(0,s.jsx)("textarea",{placeholder:"Type a message...",value:x,onChange:n=>{u&&(e(u,!0),c(new Date().getTime())),m(n.target.value)},className:"textarea textarea-bordered w-full resize-none rounded-2xl mb-2 textarea-primary"}),(0,s.jsxs)("div",{className:"flex flex-row justify-between space-x-2",children:[(0,s.jsx)("button",{className:"btn btn-primary rounded-2xl flex-grow",disabled:!u||""===x.trim(),onClick:()=>{u&&(n(u,x),m(""),e(u,!1))},children:"Send Message"}),(0,s.jsx)(o,{})]})]})},d=()=>{let{chatMessages:e}=(0,l.U)(),{users:n}=(0,a.U)(),[t,i]=(0,r.useState)([]);(0,r.useEffect)(()=>{e&&i(n=>[...n,...e])},[e]);let o=null==t?void 0:t.map(e=>{let{id:t,text:s}=e,r=n.find(e=>e.id===t);return(null==r?void 0:r.name)?"".concat(r.name,": ").concat(s):"".concat(t,": ").concat(s)}).join("\n");return(0,s.jsx)("textarea",{className:"textarea textarea-bordered w-full flex-1 resize-none rounded-2xl textarea-primary overflow-visible",readOnly:!0,value:o,onChange:()=>{}},JSON.stringify(t))};function c(){let{usersWhoAreTyping:e}=(0,l.U)(),{thisUser:n,users:t}=(0,a.U)(),r=e.filter(e=>n!==e),i=r.length>0,o=null;return i&&(o=r.reduce((e,n)=>{""!==e&&(e+=", ");let s=t.find(e=>e.id===n);return(null==s?void 0:s.name)?e+=s.name:e+=n,e},""),1===r.length?o+=" is typing":r.length>1&&(o+=" are typing")),(0,s.jsx)("div",{className:"h-[26.5px]",children:(0,s.jsxs)("div",{children:[i?(0,s.jsx)("div",{className:"loading loading-dots loading-sm top-1 relative mr-2"}):null,o]})})}function f(){let{thisUser:e,users:n}=(0,a.U)(),t=n.find(n=>n.id===e),r=n.reduce((n,t)=>(t.id===e||(""!==n&&(n+=", "),t.name?n+=t.name:n+=t.id),n),"");return(0,s.jsxs)("div",{className:"connected-users",children:["Users: (",n.length,") ",r,0!==r.length?", ":"",(0,s.jsx)("span",{className:"text-green-600",children:(null==t?void 0:t.name)?t.name:null==t?void 0:t.id})]})}let x=e=>{let{room:n}=e;return(0,s.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,s.jsx)("div",{className:"form-control flex-1",children:(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsx)(f,{}),(0,s.jsx)(d,{})]})}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 mt-2",children:[(0,s.jsx)(c,{}),(0,s.jsx)(u,{})]})]})}},2666:function(e,n,t){t.d(n,{x:function(){return o},U:function(){return u}});var s=t(7437),r=t(2265),a=t(9664);({...a.v});var l=t(8265);let i=r.createContext(void 0);function o(e){let{children:n}=e,{sendJson:t}=(0,l.sV)(),[a,o]=(0,r.useState)([]),[u,d]=(0,r.useState)([]);(0,l.I8)(e=>{o([e])},"newMessage"),(0,l.I8)(d,"isTyping"),(0,l.I8)(o,"messages");let c=(0,r.useCallback)((e,n)=>{t({newMessage:{id:e,text:n}})},[t]),f=(0,r.useCallback)((e,n)=>{n?t({isTyping:e}):t({isNotTyping:e})},[t]);return(0,s.jsx)(i.Provider,{value:{chatMessages:a,sendMessage:c,sendIsTyping:f,usersWhoAreTyping:u},children:n})}function u(){let e=r.useContext(i);if(void 0===e)throw Error("useSocketMessage must be used within a MessageProvider");return e}},8265:function(e,n,t){t.d(n,{I8:function(){return u},sV:function(){return o},wP:function(){return i}});var s=t(7437),r=t(2265),a=t(3018);let l=r.createContext(void 0);function i(e){let{children:n,room:t}=e,[i,o]=(0,r.useState)({}),u=(0,a.Z)({host:"localhost:1999",room:t,onClose(){},onMessage(e){o(JSON.parse(e.data))}}),d=(0,r.useCallback)(e=>{u.send(JSON.stringify(e))},[u]);return(0,s.jsx)(l.Provider,{value:{messages:i,setMessages:o,sendJson:d},children:n})}function o(){let e=r.useContext(l);if(void 0===e)throw Error("useSocket must be used within a SocketProvider");return e}function u(e,n){let{messages:t,setMessages:s}=o(),a=t[n];(0,r.useEffect)(()=>{a&&(s({}),e(a))},[e,a,s])}},2693:function(e,n,t){t.d(n,{K:function(){return u},U:function(){return d}});var s=t(7437),r=t(2265),a=t(8265),l=t(9664);({...l.v});var i=t(8045);let o=r.createContext(void 0);function u(e){let{children:n}=e,{sendJson:t}=(0,a.sV)(),[l,u]=(0,r.useState)([]),[d,c]=(0,r.useState)(null);return(0,i.KS)(()=>{if(!d)throw Error("Could not get the current user id?")},3e3),(0,a.I8)(c,"userId"),(0,a.I8)(u,"users"),(0,a.I8)(e=>{u(n=>[...n,e])},"newUser"),(0,a.I8)(e=>{u(n=>n.filter(n=>n.id!==e))},"removeUser"),(0,a.I8)(e=>{u(n=>n.map(n=>n.id===e.id&&e.name?{...n,name:e.name}:n))},"nameChanged"),(0,r.useEffect)(()=>()=>{d&&t({removeUser:d})},[t,d]),(0,s.jsx)(o.Provider,{value:{thisUser:d,users:l,sendName:e=>t({changeName:e})},children:n})}function d(){let e=r.useContext(o);if(void 0===e)throw Error("useUsers must be used within a UsersProvider");return e}},9664:function(e,n,t){function s(e){this.send(JSON.stringify(e))}function r(e,n){this.broadcast(JSON.stringify(e),n)}t.d(n,{v:function(){return a}});let a={onConnect(e,n){e.sendJson=s,n.broadcastJson=r,this.onConnectExtended(e,n)},onClose(e,n){e.sendJson=s,n.broadcastJson=r,this.onCloseExtended(e,n)},onMessage(e,n,t){n.sendJson=s,t.broadcastJson=r,this.onMessageExtended(e,n,t)},onMessageExtended(e,n,t){},onConnectExtended(e,n){},onCloseExtended(e,n){}}}}]);