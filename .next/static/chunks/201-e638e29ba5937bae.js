"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[201],{8045:function(e,t,s){s.d(t,{Nr:function(){return r},LI:function(){return i},KS:function(){return o}});var n=s(2265),r=function(e,t){let[s,r]=(0,n.useState)(e);return(0,n.useEffect)(()=>{let s=setTimeout(()=>r(e),t||500);return()=>{clearTimeout(s)}},[e,t]),s},i="undefined"!=typeof window?n.useLayoutEffect:n.useEffect,o=function(e,t){let s=(0,n.useRef)(e);i(()=>{s.current=e},[e]),(0,n.useEffect)(()=>{if(!t&&0!==t)return;let e=setTimeout(()=>s.current(),t);return()=>clearTimeout(e)},[t])}},3018:function(e,t,s){s.d(t,{Z:function(){return u}});var n={ErrorEvent:class extends Event{message;error;constructor(e,t){super("error",t),this.message=e.message,this.error=e}},CloseEvent:class extends Event{code;reason;wasClean=!0;constructor(e=1e3,t="",s){super("close",s),this.code=e,this.reason=t}}};function r(e){return new e.constructor(e.type,e)}var i={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0},o=class e extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_url;_protocols;_options;constructor(e,t,s={}){super(),this._url=e,this._protocols=t,this._options=s,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return e.CONNECTING}get OPEN(){return e.OPEN}get CLOSING(){return e.CLOSING}get CLOSED(){return e.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((e,t)=>("string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(e=1e3,t){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,t)}reconnect(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED&&this._disconnect(e,t),this._connect()}send(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{let{maxEnqueuedMessages:t=i.maxEnqueuedMessages}=this._options;this._messageQueue.length<t&&(this._debug("enqueue",e),this._messageQueue.push(e))}}_debug(...e){this._options.debug&&console.log.apply(console,["RWS>",...e])}_getNextDelay(){let{reconnectionDelayGrowFactor:e=i.reconnectionDelayGrowFactor,minReconnectionDelay:t=i.minReconnectionDelay,maxReconnectionDelay:s=i.maxReconnectionDelay}=this._options,n=0;return this._retryCount>0&&(n=t*Math.pow(e,this._retryCount-1))>s&&(n=s),this._debug("next delay",n),n}_wait(){return new Promise(e=>{setTimeout(e,this._getNextDelay())})}_getNextProtocols(e){if(!e)return Promise.resolve(null);if("string"==typeof e||Array.isArray(e))return Promise.resolve(e);if("function"==typeof e){let t=e();if(!t)return Promise.resolve(null);if("string"==typeof t||Array.isArray(t))return Promise.resolve(t);if(t.then)return t}throw Error("Invalid protocols")}_getNextUrl(e){if("string"==typeof e)return Promise.resolve(e);if("function"==typeof e){let t=e();if("string"==typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")}_connect(){var e;if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;let{maxRetries:t=i.maxRetries,connectionTimeout:s=i.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!(void 0!==(e=WebSocket)&&e&&"function"==typeof e&&"CLOSING"in e&&2===e.CLOSING))throw Error("No valid WebSocket class provided");this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([e,t])=>{if(this._closeCalled){this._connectLock=!1;return}this._debug("connect",{url:e,protocols:t}),this._ws=t?new WebSocket(e,t):new WebSocket(e),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),s)}).catch(e=>{this._connectLock=!1,this._handleError(new n.ErrorEvent(Error(e.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new n.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(e=1e3,t){if(this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new n.CloseEvent(e,t,this))}catch(e){}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=e=>{this._debug("open event");let{minUptime:t=i.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),t),function(e,t){if(!e)throw Error(t)}(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(e=>this._ws?.send(e)),this._messageQueue=[],this.onopen&&this.onopen(e),this.dispatchEvent(r(e))};_handleMessage=e=>{this._debug("message event"),this.onmessage&&this.onmessage(e),this.dispatchEvent(r(e))};_handleError=e=>{this._debug("error event",e.message),this._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),this.onerror&&this.onerror(e),this._debug("exec error listeners"),this.dispatchEvent(r(e)),this._connect()};_handleClose=e=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(e),this.dispatchEvent(r(e))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}},h=class extends o{constructor(e){let{host:t,room:s,party:n,protocol:r,query:i,protocols:o,...h}=e,c=e.id||function(){if(crypto.randomUUID)return crypto.randomUUID();let e=new Date().getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){let n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===s?n:3&n|8).toString(16)})}(),u=`${r||(t.startsWith("localhost:")||t.startsWith("127.0.0.1:")?"ws":"wss")}://${t}/${n?`parties/${n}`:"party"}/${s}`;i?u+=`?${new URLSearchParams({...i,_pk:c}).toString()}`:u+=`?_pk=${c}`,super(u,o,h),this.partySocketOptions=e,this._pk=c}_pk},c=s(2265);function u(e){let{onOpen:t,onMessage:s,onClose:n,onError:r,...i}=e,o=(0,c.useRef)(new h({...i,startClosed:!0}));return(0,c.useEffect)(()=>{let e=o.current;return t&&e.addEventListener("open",t),n&&e.addEventListener("close",n),r&&e.addEventListener("error",r),s&&e.addEventListener("message",s),()=>{t&&e.removeEventListener("open",t),n&&e.removeEventListener("close",n),r&&e.removeEventListener("error",r),s&&e.removeEventListener("message",s)}},[t,s,n,r]),(0,c.useEffect)(()=>{let t=o.current;return!0!==e.startClosed&&t.reconnect(),()=>{t.close()}},[]),o.current}}}]);